import{r,j as e}from"./app-WfcFsLDc.js";import{I as Y}from"./input-error-Bizgct0K.js";import{B as U}from"./button-BQc4BMzP.js";import{b as A,c as $,d as G,e as O,f as H}from"./dialog-DlaWNHNY.js";import{I as c}from"./input-xy2JWuUu.js";import{L as l}from"./label-DaQoZ2Xn.js";import{S as X,a as Z,b as ee,c as te,e as ie,d as m}from"./select-IkYrrM1k.js";import{S as re}from"./switch-piBPkdDd.js";import{T as J}from"./textarea-CNcsO3we.js";import{E as ae}from"./Editor-e0ysnhb6.js";import"./utils-BUpMR2Rv.js";import"./index-BnYB0xB7.js";import"./index-kk7XcMq0.js";import"./createLucideIcon-7PYJ0F62.js";import"./index-Ck0wp_cw.js";import"./Combination-Q8-bZD9q.js";import"./index-wUpaGSPo.js";import"./index-B_41Fkoq.js";import"./floating-ui.react-dom-F9VUPZJ-.js";import"./index-BgaW-yYt.js";import"./index-D28vQkda.js";import"./index-Cp7U2nMF.js";import"./chevron-down-BL74U03m.js";import"./check-DQPGv3Lh.js";import"./chevron-up-CXOfLK5c.js";function se(u){const d=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,i=u.match(d);return i&&i[2].length===11?i[2]:""}function Te({setOpen:u,onEdit:d,lesson:i}){var D,E,I,L,M,P;const[p,x]=r.useState(i.title),[s,f]=r.useState(i.type),[g,b]=r.useState(i.description??""),[h,j]=r.useState(i.is_free??!1),[v,y]=r.useState(i.content??""),[n,k]=r.useState(i.video_url??""),[a,z]=r.useState(i.attachment??null),[K,w]=r.useState(""),[F,N]=r.useState(((E=(D=i.quizzes)==null?void 0:D[0])==null?void 0:E.instructions)||""),[S,q]=r.useState(((L=(I=i.quizzes)==null?void 0:I[0])==null?void 0:L.time_limit)||0),[C,_]=r.useState(((P=(M=i.quizzes)==null?void 0:M[0])==null?void 0:P.passing_score)||0),T=r.useRef(null);r.useEffect(()=>{var t,o,B,Q,V,R;x(i.title),f(i.type),b(i.description??""),j(i.is_free??!1),y(i.content??""),k(i.video_url??""),z(i.attachment??null),N(((o=(t=i.quizzes)==null?void 0:t[0])==null?void 0:o.instructions)||""),q(((Q=(B=i.quizzes)==null?void 0:B[0])==null?void 0:Q.time_limit)||0),_(((R=(V=i.quizzes)==null?void 0:V[0])==null?void 0:R.passing_score)||0),w("")},[i]);const W=t=>{var o;if(t.preventDefault(),!p.trim()){w("Judul materi harus diisi"),(o=T.current)==null||o.focus();return}d({title:p,type:s,description:g,is_free:h,content:s==="text"?v:void 0,video_url:s==="video"?n:void 0,attachment:s==="file"?a??i.attachment:void 0,quizzes:s==="quiz"?[{instructions:F,time_limit:S,passing_score:C}]:void 0})};return e.jsxs(A,{children:[e.jsx($,{children:"Edit Materi"}),e.jsx(G,{children:"Ubah judul, tipe, dan deskripsi materi."}),e.jsxs("form",{className:"space-y-6",onSubmit:W,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"title",className:"sr-only",children:"Judul Materi"}),e.jsx(c,{id:"title",type:"text",name:"title",ref:T,value:p,onChange:t=>x(t.target.value),placeholder:"Judul Materi",autoComplete:"off"}),e.jsx(Y,{message:K}),e.jsx(l,{htmlFor:"description",className:"sr-only",children:"Deskripsi Materi"}),e.jsx(J,{id:"description",name:"description",value:g,onChange:t=>b(t.target.value),placeholder:"Deskripsi Materi (opsional)",className:"max-h-[300px] min-h-[80px] w-full resize-none break-words whitespace-pre-line",style:{overflowWrap:"break-word",wordBreak:"break-word"}}),e.jsx(l,{htmlFor:"type",className:"sr-only",children:"Tipe Materi"}),e.jsxs(X,{value:s,onValueChange:t=>f(t),children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Pilih tipe materi"})}),e.jsx(te,{children:e.jsxs(ie,{children:[e.jsx(m,{value:"text",children:"Text"}),e.jsx(m,{value:"video",children:"Video"}),e.jsx(m,{value:"file",children:"File"}),e.jsx(m,{value:"quiz",children:"Quiz"})]})})]}),s==="text"&&e.jsxs("div",{children:[e.jsx(l,{htmlFor:"content",className:"mb-1 block text-sm font-medium",children:"Konten Materi"}),e.jsx(ae,{apiKey:"7apjqdre3ocnt08y5t5zlqyaytlom537pj6qbe0hlxhborco",value:v,onEditorChange:t=>y(t),init:{plugins:["anchor","autolink","charmap","codesample","emoticons","image","link","lists","media","searchreplace","table","visualblocks","wordcount"],onboarding:!1,toolbar:"undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | addcomment showcomments | spellcheckdialog a11ycheck typography | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat",tinycomments_mode:"embedded",tinycomments_author:"Author name",mergetags_list:[{value:"First.Name",title:"First Name"},{value:"Email",title:"Email"}],height:300}})]}),s==="video"&&e.jsxs("div",{children:[e.jsx(l,{htmlFor:"video-link",className:"mb-1 block text-sm font-medium",children:"Link YouTube Video"}),e.jsx(c,{id:"video-link",type:"text",placeholder:"https://www.youtube.com/watch?v=xxxxxx",value:n,onChange:t=>k(t.target.value)}),n&&n.trim()!==""&&e.jsx("div",{className:"mt-2",children:e.jsx("iframe",{className:"rounded border",width:"100%",height:"250",src:n.includes("youtube.com")||n.includes("youtu.be")?`https://www.youtube.com/embed/${se(n)}`:"",title:"YouTube Preview",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})]}),s==="file"&&e.jsxs("div",{children:[e.jsx(l,{htmlFor:"attachment",className:"mb-1 block text-sm font-medium",children:"Upload File (Format PDF)"}),e.jsx(c,{id:"attachment",type:"file",accept:"application/pdf",onChange:t=>{var o;return z(((o=t.target.files)==null?void 0:o[0])??null)}}),(()=>{let t=null;return a instanceof File?t={type:"file",url:URL.createObjectURL(a)}:typeof a=="string"&&a&&(t={type:"file",url:a.startsWith("http")?a:`/storage/${a}`}),(t==null?void 0:t.type)==="file"&&t.url&&e.jsxs("div",{className:"mt-2 w-full rounded border p-2",children:[e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs",children:[e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"mb-2 rounded bg-black/60 px-2 py-1 text-xs text-white hover:bg-black/80",title:"Tampilkan Fullscreen",children:a instanceof File?"Fullscreen":"Lihat File Lama"}),a instanceof File&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a.name}),e.jsxs("span",{children:["(",Math.round(a.size/1024)," KB)"]})]})]}),e.jsx("object",{data:t.url,type:"application/pdf",width:"100%",height:"200px",children:e.jsxs("p",{children:["Preview tidak tersedia."," ",e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",children:"Download PDF"})]})})]})})()]}),s==="quiz"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"quiz-instructions",className:"sr-only",children:"Instruksi Quiz"}),e.jsx(J,{id:"quiz-instructions",name:"quiz-instructions",value:F,onChange:t=>N(t.target.value),placeholder:"Instruksi untuk quiz (opsional)",className:"max-h-[300px] min-h-[80px] w-full resize-none break-words whitespace-pre-line",style:{overflowWrap:"break-word",wordBreak:"break-word"}}),e.jsx(l,{htmlFor:"quiz-time-limit",className:"mb-1 block text-sm font-medium",children:"Time Limit (menit)"}),e.jsx(c,{id:"quiz-time-limit",type:"number",min:0,placeholder:"0 (tanpa batas waktu)",value:S,onChange:t=>q(Number(t.target.value))}),e.jsx(l,{htmlFor:"quiz-passing-score",className:"mb-1 block text-sm font-medium",children:"Passing Score"}),e.jsx(c,{id:"quiz-passing-score",type:"number",min:0,max:100,placeholder:"Nilai minimal lulus (0-100)",value:C,onChange:t=>_(Number(t.target.value))})]}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[e.jsx(re,{id:"is-free",checked:h,onCheckedChange:j}),e.jsx(l,{htmlFor:"is-free",children:h?"Materi ini gratis":"Materi ini berbayar"})]})]}),e.jsxs(O,{className:"gap-2",children:[e.jsx(H,{asChild:!0,children:e.jsx(U,{variant:"secondary",onClick:()=>u(!1),className:"hover:cursor-pointer",children:"Batal"})}),e.jsx(U,{type:"submit",className:"hover:cursor-pointer",children:"Simpan Perubahan"})]})]})]})}export{Te as default};
